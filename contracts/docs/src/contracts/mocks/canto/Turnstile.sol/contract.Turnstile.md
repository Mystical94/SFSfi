# Turnstile
[Git Source](https://gitlab.com/csrCANTO/contracts/blob/9e6fbddb480a4292129b35049a7179a5a11f8cfc/contracts/mocks/canto/Turnstile.sol)

**Inherits:**
Ownable, ERC721Enumerable

**Author:**
Canto-Network (https://canto.io)

Implementation of CIP-001 https://github.com/Canto-Improvement-Proposals/CIPs/blob/main/CIP-001.md
- contract address: 0xEcf044C5B4b867CFda001101c617eCd347095B44
- explorer: https://tuber.build/address/0xEcf044C5B4b867CFda001101c617eCd347095B44
- sources: https://github.com/Canto-Network/Canto/blob/csr/contracts/turnstile.sol

*Every contract is responsible to register itself in the constructor by calling `register(address)`.
If contract is using proxy pattern, it's possible to register retroactively, however past fees will be lost.
Recipient withdraws fees by calling `withdraw(uint256,address,uint256)`.*


## State Variables
### _tokenIdTracker

```solidity
Counters.Counter private _tokenIdTracker;
```


### feeRecipient
maps smart contract address to tokenId


```solidity
mapping(address => NftData) public feeRecipient;
```


### balances
maps tokenId to fees earned


```solidity
mapping(uint256 => uint256) public balances;
```


## Functions
### onlyNftOwner

*only owner of _tokenId can call this function*


```solidity
modifier onlyNftOwner(uint256 _tokenId);
```

### onlyUnregistered

*only smart contract that is unregistered can call this function*


```solidity
modifier onlyUnregistered();
```

### constructor


```solidity
constructor() ERC721("Turnstile", "Turnstile");
```

### currentCounterId

Returns current value of counter used to tokenId of new minted NFTs


```solidity
function currentCounterId() external view returns (uint256);
```
**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint256`|current counter value|


### getTokenId

Returns tokenId that collects fees generated by the smart contract


```solidity
function getTokenId(address _smartContract) external view returns (uint256);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_smartContract`|`address`|address of the smart contract|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint256`|tokenId that collects fees generated by the smart contract|


### isRegistered

Returns true if smart contract is registered to collect fees


```solidity
function isRegistered(address _smartContract) public view returns (bool);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_smartContract`|`address`|address of the smart contract|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`bool`|true if smart contract is registered to collect fees, false otherwise|


### register

Mints ownership NFT that allows the owner to collect fees earned by the smart contract.
`msg.sender` is assumed to be a smart contract that earns fees. Only smart contract itself
can register a fee receipient.


```solidity
function register(address _recipient) public onlyUnregistered returns (uint256 tokenId);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_recipient`|`address`|recipient of the ownership NFT|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`tokenId`|`uint256`|of the ownership NFT that collects fees|


### assign

Assigns smart contract to existing NFT. That NFT will collect fees generated by the smart contract.
Callable only by smart contract itself.


```solidity
function assign(uint256 _tokenId) public onlyUnregistered returns (uint256);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_tokenId`|`uint256`|tokenId which will collect fees|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint256`|tokenId of the ownership NFT that collects fees|


### withdraw

Withdraws earned fees to `_recipient` address. Only callable by NFT owner.


```solidity
function withdraw(uint256 _tokenId, address payable _recipient, uint256 _amount)
    public
    onlyNftOwner(_tokenId)
    returns (uint256);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_tokenId`|`uint256`|token Id|
|`_recipient`|`address payable`|recipient of fees|
|`_amount`|`uint256`|amount of fees to withdraw|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint256`|amount of fees withdrawn|


### distributeFees

Distributes collected fees to the smart contract. Only callable by owner.


```solidity
function distributeFees(uint256 _tokenId) public payable onlyOwner;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`_tokenId`|`uint256`|NFT that earned fees|


## Events
### Register

```solidity
event Register(address smartContract, address recipient, uint256 tokenId);
```

### Assign

```solidity
event Assign(address smartContract, uint256 tokenId);
```

### Withdraw

```solidity
event Withdraw(uint256 tokenId, address recipient, uint256 feeAmount);
```

### DistributeFees

```solidity
event DistributeFees(uint256 tokenId, uint256 feeAmount);
```

## Errors
### NotAnOwner

```solidity
error NotAnOwner();
```

### NotSmartContract

```solidity
error NotSmartContract();
```

### AlreadyRegistered

```solidity
error AlreadyRegistered();
```

### Unregistered

```solidity
error Unregistered();
```

### InvalidRecipient

```solidity
error InvalidRecipient();
```

### InvalidTokenId

```solidity
error InvalidTokenId();
```

### NothingToWithdraw

```solidity
error NothingToWithdraw();
```

### NothingToDistribute

```solidity
error NothingToDistribute();
```

## Structs
### NftData

```solidity
struct NftData {
    uint256 tokenId;
    bool registered;
}
```

